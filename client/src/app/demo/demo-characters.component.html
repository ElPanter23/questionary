<div class="card">
  <div class="demo-header mb-4">
    <div class="demo-info">
      <h2 class="text-center mb-2">üë• {{ i18nService.getTranslation('characters') }} ({{ i18nService.getTranslation('demoMode') }})</h2>
      <p class="text-center text-muted">{{ i18nService.getTranslation('sessionId') }}: <code>{{ sSessionId }}</code></p>
    </div>
    <button class="btn btn-secondary" (click)="backToDemoLanding()">
      ‚Üê {{ i18nService.getTranslation('backToDemo') }}
    </button>
  </div>

  <!-- Demo Navigation -->
  <nav class="card mb-4">
    <div class="grid grid-3">
      <a [routerLink]="['/demo', sSessionId]" class="btn btn-secondary" routerLinkActive="active">
        üéÆ {{ i18nService.getTranslation('game') }}
      </a>
      <a [routerLink]="['/demo', sSessionId, 'characters']" class="btn btn-secondary" routerLinkActive="active">
        üë• {{ i18nService.getTranslation('characters') }}
      </a>
      <a [routerLink]="['/demo', sSessionId, 'questions']" class="btn btn-secondary" routerLinkActive="active">
        ‚ùì {{ i18nService.getTranslation('questions') }}
      </a>
    </div>
  </nav>
  
  <!-- Neuen Charakter hinzuf√ºgen -->
  <div class="mb-4">
    <h3>{{ i18nService.getTranslation('addNewCharacter') }}</h3>
    <form (ngSubmit)="addCharacter()" #characterForm="ngForm">
      <div class="form-group">
        <label class="form-label" for="name">{{ i18nService.getTranslation('name') }} *</label>
        <input 
          type="text" 
          id="name" 
          name="name" 
          class="form-control" 
          [(ngModel)]="newCharacter.name" 
          required
          [placeholder]="i18nService.getTranslation('placeholderCharacterName')">
      </div>
      
      <div class="form-group">
        <label class="form-label" for="description">{{ i18nService.getTranslation('description') }}</label>
        <textarea 
          id="description" 
          name="description" 
          class="form-control textarea" 
          [(ngModel)]="newCharacter.description"
          [placeholder]="i18nService.getTranslation('placeholderCharacterDescription')"></textarea>
      </div>
      
      <button type="submit" class="btn" [disabled]="!characterForm.form.valid || bIsLoading">
        {{ bIsLoading ? i18nService.getTranslation('adding') : i18nService.getTranslation('addCharacter') }}
      </button>
    </form>
  </div>

  <!-- Character Management Actions -->
  <div class="mb-4">
    <button class="btn btn-danger" (click)="resetAllCharacters()">
      üîÑ {{ i18nService.getTranslation('resetAllCharacters') }}
    </button>
  </div>

  <!-- Characters List -->
  <div *ngIf="!bIsLoading && oCharacters.length > 0" class="characters-list">
    <div 
      *ngFor="let character of oCharacters" 
      class="character-item">
      <div class="character-info">
        <h3>{{ character.name }}</h3>
        <p *ngIf="character.description">{{ character.description }}</p>
        <div class="character-stats" *ngIf="getCharacterStatus(character.id)">
          <div class="stat-item">
            <span class="stat-label">{{ i18nService.getTranslation('answeredQuestions') }}:</span>
            <span class="stat-value">{{ getCharacterStatus(character.id)?.answered_count || 0 }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">{{ i18nService.getTranslation('availableQuestions') }}:</span>
            <span class="stat-value">{{ getCharacterStatus(character.id)?.total_questions || 0 }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">{{ i18nService.getTranslation('progress') }}:</span>
            <span class="stat-value">
              {{ getCharacterStatus(character.id)?.answered_count || 0 }} / {{ getCharacterStatus(character.id)?.total_questions || 0 }}
            </span>
          </div>
        </div>
      </div>
      
      <div class="character-actions">
        <button 
          class="btn btn-secondary" 
          (click)="viewCharacterDetails(character)">
          {{ i18nService.getTranslation('questionsAndAnswers') }}
        </button>
        <button 
          class="btn btn-warning" 
          (click)="resetCharacterProgress(character.id)">
          {{ i18nService.getTranslation('resetCharacter') }}
        </button>
      </div>
    </div>
  </div>

  <!-- No Characters -->
  <div *ngIf="!bIsLoading && oCharacters.length === 0" class="text-center">
    <p>{{ i18nService.getTranslation('noCharactersYet') }}</p>
  </div>

  <!-- Loading -->
  <div *ngIf="bIsLoading" class="loading">
    <p>{{ i18nService.getTranslation('loading') }}</p>
  </div>

  <!-- Error -->
  <div *ngIf="sError" class="error">
    {{ sError }}
  </div>

  <!-- Success -->
  <div *ngIf="sSuccessMessage" class="success">
    {{ sSuccessMessage }}
  </div>

  <!-- Charakter-Details Modal -->
  <div *ngIf="selectedCharacter" class="card mt-4 character-details-modal">
    <div class="character-details-header">
      <h2>{{ selectedCharacter.name }} - {{ i18nService.getTranslation('characterDetails') }}</h2>
      <button class="btn btn-secondary" (click)="closeCharacterDetails()">
        ‚úï {{ i18nService.getTranslation('close') }}
      </button>
    </div>
    
    <div class="character-details-content">
      <div class="character-info">
        <div class="info-row">
          <label>{{ i18nService.getTranslation('id') }}</label>
          <span>#{{ selectedCharacter.id }}</span>
        </div>
        <div class="info-row">
          <label>{{ i18nService.getTranslation('name') }}:</label>
          <span>{{ selectedCharacter.name }}</span>
        </div>
        <div class="info-row">
          <label>{{ i18nService.getTranslation('description') }}:</label>
          <span>{{ selectedCharacter.description || i18nService.getTranslation('noDescription') }}</span>
        </div>
             <div class="info-row">
               <label>{{ i18nService.getTranslation('created') }}:</label>
               <span>{{ selectedCharacter.created_at ? formatDate(selectedCharacter.created_at) : i18nService.getTranslation('unknown') }}</span>
             </div>
      </div>
      
      <div class="character-stats" *ngIf="characterStats">
        <h3>{{ i18nService.getTranslation('statistics') }}</h3>
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-value">{{ characterStats.answered_count || 0 }}</div>
            <div class="stat-label">{{ i18nService.getTranslation('answeredQuestions') }}</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">{{ characterStats.total_questions || 0 }}</div>
            <div class="stat-label">{{ i18nService.getTranslation('availableQuestions') }}</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">{{ getProgressPercentage() }}%</div>
            <div class="stat-label">{{ i18nService.getTranslation('progress') }}</div>
          </div>
        </div>
      </div>
      
      <div class="character-actions-details">
        <button class="btn btn-primary" (click)="startGameWithCharacter(selectedCharacter)">
          üéÆ {{ i18nService.getTranslation('startGame') }}
        </button>
        <button class="btn btn-warning" (click)="resetCharacterProgress(selectedCharacter.id)">
          üîÑ {{ i18nService.getTranslation('resetProgress') }}
        </button>
      </div>
      
      <div class="character-qa-history" *ngIf="characterAnswers.length > 0">
        <h3>{{ i18nService.getTranslation('questionsAndAnswers') }} ({{ characterAnswers.length }})</h3>
        <div class="qa-list">
          <div *ngFor="let answer of characterAnswers" class="qa-item">
            <div class="qa-question">
              <strong>{{ i18nService.getTranslation('questions') }} #{{ answer.id }}:</strong> {{ answer.question.text }}
              <span *ngIf="answer.question.category" class="qa-category">{{ answer.question.category }}</span>
            </div>
            <div class="qa-answer">
              <strong>{{ i18nService.getTranslation('yourAnswer') }}:</strong> {{ answer.answer_text }}
            </div>
            <div class="qa-meta">
              <small class="text-muted">
                {{ i18nService.getTranslation('answeredOn') }} {{ formatDate(answer.answered_at) }}
              </small>
            </div>
          </div>
        </div>
      </div>
      
      <div class="character-qa-history" *ngIf="characterAnswers.length === 0 && characterStats && characterStats.answered_count === 0">
        <h3>{{ i18nService.getTranslation('questionsAndAnswers') }}</h3>
        <p class="text-muted">{{ i18nService.getTranslation('noQuestionsAnsweredYet') }}</p>
      </div>
    </div>
  </div>
</div>
